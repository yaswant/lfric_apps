@@ -1,15 +1,15 @@
-module adjoint_test_mod
+module atlt_kinetic_energy_gradient_alg_mod
   implicit none
   public
 
   contains
-  subroutine adjoint_test(mesh, chi, panel_id)
+  subroutine atlt_kinetic_energy_gradient_alg(mesh, chi, panel_id)
     use field_mod, only : field_type
     use function_space_mod, only : function_space_type
     use mesh_mod, only : mesh_type
     use function_space_collection_mod, only : function_space_collection
     use tl_kinetic_energy_gradient_kernel_mod, only : tl_kinetic_energy_gradient_kernel_type
-    use adj_kinetic_energy_gradient_kernel_mod, only : adj_kinetic_energy_gradient_kernel_type
+    use atl_kinetic_energy_gradient_kernel_mod, only : atl_kinetic_energy_gradient_kernel_type
     use finite_element_config_mod, only : element_order
     use fs_continuity_mod, only : w0, w2, w3
     use quadrature_xyoz_mod, only : quadrature_xyoz_type
@@ -27,26 +27,15 @@
     type(field_type) :: r_u
     type(field_type) :: u
     type(field_type) :: ls_u
-    type(field_type), dimension(3) :: chi_3
-    type(field_type) :: panel_id_1
     type(quadrature_xyoz_type) :: qr_xyoz
     type(quadrature_rule_gaussian_type) :: quadrature_rule
     type(field_type) :: r_u_input
     type(field_type) :: u_input
-    type(field_type) :: ls_u_input
-    type(field_type), dimension(3) :: chi_3_input
-    type(field_type) :: panel_id_1_input
     real(kind=r_def) :: r_u_inner_prod
     real(kind=r_def) :: u_inner_prod
-    real(kind=r_def) :: ls_u_inner_prod
-    real(kind=r_def), dimension(3) :: chi_3_inner_prod
-    real(kind=r_def) :: panel_id_1_inner_prod
     real(kind=r_def) :: inner1
     real(kind=r_def) :: r_u_r_u_input_inner_prod
     real(kind=r_def) :: u_u_input_inner_prod
-    real(kind=r_def) :: ls_u_ls_u_input_inner_prod
-    real(kind=r_def), dimension(3) :: chi_3_chi_3_input_inner_prod
-    real(kind=r_def) :: panel_id_1_panel_id_1_input_inner_prod
     real(kind=r_def) :: inner2
     real(kind=r_def) :: MachineTol
     real(kind=r_def) :: relative_diff
@@ -57,63 +46,25 @@
     call r_u % initialise(vector_space=vector_space_w2_ptr, name='r_u')
     call u % initialise(vector_space=vector_space_w2_ptr, name='u')
     call ls_u % initialise(vector_space=vector_space_w2_ptr, name='ls_u')
-    call chi_3(1_i_def) % initialise(vector_space=vector_space_w0_ptr, name='chi_3')
-    call chi_3(2_i_def) % initialise(vector_space=vector_space_w0_ptr, name='chi_3')
-    call chi_3(3_i_def) % initialise(vector_space=vector_space_w0_ptr, name='chi_3')
-    call panel_id_1 % initialise(vector_space=vector_space_w3_ptr, name='panel_id_1')
     qr_xyoz = quadrature_xyoz_type(element_order + 3,quadrature_rule)
     call r_u_input % initialise(vector_space=vector_space_w2_ptr, name='r_u_input')
     call u_input % initialise(vector_space=vector_space_w2_ptr, name='u_input')
-    call ls_u_input % initialise(vector_space=vector_space_w2_ptr, name='ls_u_input')
-    call chi_3_input(1_i_def) % initialise(vector_space=vector_space_w0_ptr, name='chi_3_input')
-    call chi_3_input(2_i_def) % initialise(vector_space=vector_space_w0_ptr, name='chi_3_input')
-    call chi_3_input(3_i_def) % initialise(vector_space=vector_space_w0_ptr, name='chi_3_input')
-    call panel_id_1_input % initialise(vector_space=vector_space_w3_ptr, name='panel_id_1_input')
     r_u_inner_prod = 0.0_r_def
     u_inner_prod = 0.0_r_def
-    ls_u_inner_prod = 0.0_r_def
-    chi_3_inner_prod(1_i_def) = 0.0_r_def
-    chi_3_inner_prod(2_i_def) = 0.0_r_def
-    chi_3_inner_prod(3_i_def) = 0.0_r_def
-    panel_id_1_inner_prod = 0.0_r_def
     ! Initialise arguments and call the tangent-linear kernel.
     call invoke(setval_random(r_u), setval_x(r_u_input, r_u), setval_random(u), setval_x(u_input, u), setval_random(ls_u), &
-&setval_x(ls_u_input, ls_u), setval_random(chi_3(1_i_def)), setval_x(chi_3_input(1_i_def), chi_3(1_i_def)), &
-&setval_random(chi_3(2_i_def)), setval_x(chi_3_input(2_i_def), chi_3(2_i_def)), setval_random(chi_3(3_i_def)), &
-&setval_x(chi_3_input(3_i_def), chi_3(3_i_def)), setval_random(panel_id_1), setval_x(panel_id_1_input, panel_id_1), &
-&tl_kinetic_energy_gradient_kernel_type(r_u, u, ls_u, chi_3, panel_id_1, qr_xyoz), x_innerproduct_x(r_u_inner_prod, r_u), &
-&x_innerproduct_x(u_inner_prod, u), x_innerproduct_x(ls_u_inner_prod, ls_u), x_innerproduct_x(chi_3_inner_prod(1_i_def), &
-&chi_3(1_i_def)), x_innerproduct_x(chi_3_inner_prod(2_i_def), chi_3(2_i_def)), x_innerproduct_x(chi_3_inner_prod(3_i_def), &
-&chi_3(3_i_def)), x_innerproduct_x(panel_id_1_inner_prod, panel_id_1))
+&tl_kinetic_energy_gradient_kernel_type(r_u, u, ls_u, chi, panel_id, qr_xyoz), x_innerproduct_x(r_u_inner_prod, r_u), &
+&x_innerproduct_x(u_inner_prod, u))
     inner1 = 0.0_r_def
     inner1 = inner1 + r_u_inner_prod
     inner1 = inner1 + u_inner_prod
-    inner1 = inner1 + ls_u_inner_prod
-    inner1 = inner1 + chi_3_inner_prod(1_i_def)
-    inner1 = inner1 + chi_3_inner_prod(2_i_def)
-    inner1 = inner1 + chi_3_inner_prod(3_i_def)
-    inner1 = inner1 + panel_id_1_inner_prod
     r_u_r_u_input_inner_prod = 0.0_r_def
     u_u_input_inner_prod = 0.0_r_def
-    ls_u_ls_u_input_inner_prod = 0.0_r_def
-    chi_3_chi_3_input_inner_prod(1_i_def) = 0.0_r_def
-    chi_3_chi_3_input_inner_prod(2_i_def) = 0.0_r_def
-    chi_3_chi_3_input_inner_prod(3_i_def) = 0.0_r_def
-    panel_id_1_panel_id_1_input_inner_prod = 0.0_r_def
-    call invoke(adj_kinetic_energy_gradient_kernel_type(r_u, u, ls_u, chi_3, panel_id_1, qr_xyoz), &
-&x_innerproduct_y(r_u_r_u_input_inner_prod, r_u, r_u_input), x_innerproduct_y(u_u_input_inner_prod, u, u_input), &
-&x_innerproduct_y(ls_u_ls_u_input_inner_prod, ls_u, ls_u_input), x_innerproduct_y(chi_3_chi_3_input_inner_prod(1_i_def), &
-&chi_3(1_i_def), chi_3_input(1_i_def)), x_innerproduct_y(chi_3_chi_3_input_inner_prod(2_i_def), chi_3(2_i_def), &
-&chi_3_input(2_i_def)), x_innerproduct_y(chi_3_chi_3_input_inner_prod(3_i_def), chi_3(3_i_def), chi_3_input(3_i_def)), &
-&x_innerproduct_y(panel_id_1_panel_id_1_input_inner_prod, panel_id_1, panel_id_1_input))
+    call invoke(atl_kinetic_energy_gradient_kernel_type(r_u, u, ls_u, chi, panel_id, qr_xyoz), &
+&x_innerproduct_y(r_u_r_u_input_inner_prod, r_u, r_u_input), x_innerproduct_y(u_u_input_inner_prod, u, u_input))
     inner2 = 0.0_r_def
     inner2 = inner2 + r_u_r_u_input_inner_prod
     inner2 = inner2 + u_u_input_inner_prod
-    inner2 = inner2 + ls_u_ls_u_input_inner_prod
-    inner2 = inner2 + chi_3_chi_3_input_inner_prod(1_i_def)
-    inner2 = inner2 + chi_3_chi_3_input_inner_prod(2_i_def)
-    inner2 = inner2 + chi_3_chi_3_input_inner_prod(3_i_def)
-    inner2 = inner2 + panel_id_1_panel_id_1_input_inner_prod
     ! Test the inner-product values for equality, allowing for the precision of the active variables
     MachineTol = SPACING(MAX(ABS(inner1), ABS(inner2)))
     relative_diff = ABS(inner1 - inner2) / MachineTol
@@ -125,6 +76,6 @@
       call log_event(log_scratch_space, log_level_error)
     end if
 
-  end subroutine adjoint_test
+  end subroutine atlt_kinetic_energy_gradient_alg
 
-end module adjoint_test_mod
+end module atlt_kinetic_energy_gradient_alg_mod
