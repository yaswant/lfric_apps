{# ########################################################################### #}
{# (c) Crown copyright 2024 Met Office. All rights reserved. #}
{# The file LICENCE, distributed with this code, contains details of the terms #}
{# under which the code may be used. #}
{# ########################################################################### #}
{% do LOG.debug("Entered site/common/jedi_lfric_tests/tasks_jedi_lfric_tests.cylc") %}

{% if task_ns.conf_name == "nwp_gal9-C12_MG" %}

    {% do task_dict.update({
        "opt_confs": ["nwp_gal9_c12"],
        "resolution": "C12_MG",
        "DT": 1800,
        "tsteps": 12,
        "mpi_parts": 6,
    }) %}

{% elif task_ns.conf_name == "runge-kutta-C12" %}

    {% do task_dict.update({
        "opt_confs": ["runge-kutta"],
        "resolution": "C12",
        "DT": 1,
        "tsteps": 20,
    }) %}

{% elif task_ns.conf_name == "forecast_gh-si-for-linear-C12" %}

    {% do task_dict.update({
        "app_name": "jedi_forecast",
        "opt_confs": ["gh-si-for-linear"],
        "resolution": "C12",
        "ancil_resolution": "C12",
        "DT": 90,
        "tsteps": 13,
        "mpi_parts": 6,
    }) %}

{% elif task_ns.conf_name == "forecast_pseudo_default-C12" %}

    {% do task_dict.update({
        "app_name": "jedi_forecast_pseudo",
        "opt_confs": ["default"],
        "resolution": "C12",
        "ancil_resolution": "C12",
        "DT": 3600,
        "tsteps": 7,
        "mpi_parts": 6,
    }) %}

{% elif task_ns.conf_name == "forecast_pseudo_pseudomodel-C12" %}

    {% do task_dict.update({
        "app_name": "jedi_forecast_pseudo",
        "opt_confs": ["pseudomodel"],
        "resolution": "C12",
        "ancil_resolution": "C12",
        "DT": 3600,
        "tsteps": 7,
        "mpi_parts": 6,
    }) %}

{% elif task_ns.conf_name == "tlm_forecast_tl_nwp_gal9-C12_MG" %}

    {% do task_dict.update({
        "app_name": "jedi_tlm_forecast_tl",
        "opt_confs": ["nwp_gal9_c12", "rrt_equals_dt", "semi_strict_solver"],
        "resolution": "C12_MG",
        "ancil_resolution": "C12",
        "DT": 1800,
        "tsteps": 13,
        "mpi_parts": 6,
    }) %}

{% elif task_ns.conf_name == "id_tlm_tests_nwp_gal9-C12_MG" %}

    {% do task_dict.update({
        "app_name": "jedi_id_tlm_tests",
        "opt_confs": ["nwp_gal9_c12"],
        "resolution": "C12_MG",
        "ancil_resolution": "C12",
        "DT": 1800,
        "tsteps": 13,
        "mpi_parts": 6,
    }) %}
{% elif task_ns.conf_name == "id_tlm_tests_nwp_gal9-1PE-C12_MG" %}

    {% do task_dict.update({
        "app_name": "jedi_id_tlm_tests",
        "opt_confs": ["nwp_gal9_c12"],
        "resolution": "C12_MG",
        "ancil_resolution": "C12",
        "DT": 1800,
        "tsteps": 13,
        "mpi_parts": 1,
    }) %}

{% elif task_ns.conf_name == "tlm_tests_nwp_gal9-C12_MG" %}

    {% do task_dict.update({
        "app_name": "jedi_tlm_tests",
        "opt_confs": ["nwp_gal9_c12", "rrt_equals_dt", "semi_strict_solver"],
        "resolution": "C12_MG",
        "ancil_resolution": "C12",
        "DT": 1800,
        "tsteps": 13,
        "mpi_parts": 6,
    }) %}

{% elif task_ns.conf_name == "tlm_tests_nwp_gal9-1PE-C12_MG" %}

    {% do task_dict.update({
        "app_name": "jedi_tlm_tests",
        "opt_confs": ["nwp_gal9_c12", "rrt_equals_dt", "semi_strict_solver"],
        "resolution": "C12_MG",
        "ancil_resolution": "C12",
        "DT": 1800,
        "tsteps": 13,
        "mpi_parts": 1,
    }) %}

{% elif task_ns.conf_name == "tlm_tests_nwp_gal9-4OMP-C12_MG" %}

    {% do task_dict.update({
        "app_name": "jedi_tlm_tests",
        "opt_confs": ["nwp_gal9_c12", "rrt_equals_dt", "semi_strict_solver"],
        "resolution": "C12_MG",
        "ancil_resolution": "C12",
        "DT": 1800,
        "tsteps": 13,
        "mpi_parts": 6,
        "threads": 4,
    }) %}

{% elif task_ns.conf_name == "tlm_tests_nwp_gal9-real_increment-4OMP-C12_MG" %}

    {% do task_dict.update({
        "app_name": "jedi_tlm_tests",
        "opt_confs": ["nwp_gal9_c12", "rrt_equals_dt", "semi_strict_solver", "real_increment"],
        "resolution": "C12_MG",
        "ancil_resolution": "C12",
        "DT": 1800,
        "tsteps": 13,
        "mpi_parts": 6,
        "threads": 4,
    }) %}

{% elif task_ns.conf_name == "tlm_tests_nwp_gal9-1PE-4OMP-C12_MG" %}

    {% do task_dict.update({
        "app_name": "jedi_tlm_tests",
        "opt_confs": ["nwp_gal9_c12", "rrt_equals_dt", "semi_strict_solver"],
        "resolution": "C12_MG",
        "ancil_resolution": "C12",
        "DT": 1800,
        "tsteps": 13,
        "mpi_parts": 1,
        "threads": 4,
    }) %}

{% elif task_ns.conf_name == "tlm_tests_nwp_gal9-dry-C12_MG" %}

    {% do task_dict.update({
        "app_name": "jedi_tlm_tests",
        "opt_confs": ["nwp_gal9_c12", "rrt_equals_dt", "semi_strict_solver", "dry"],
        "resolution": "C12_MG",
        "ancil_resolution": "C12",
        "DT": 1800,
        "tsteps": 13,
        "mpi_parts": 6,
    }) %}

{% elif task_ns.conf_name == "tlm_tests_nwp_gal9-dry-1PE-C12_MG" %}

    {% do task_dict.update({
        "app_name": "jedi_tlm_tests",
        "opt_confs": ["nwp_gal9_c12", "rrt_equals_dt", "semi_strict_solver", "dry"],
        "resolution": "C12_MG",
        "ancil_resolution": "C12",
        "DT": 1800,
        "tsteps": 13,
        "mpi_parts": 1,
    }) %}

{% elif task_ns.conf_name == "tlm_tests_nwp_gal9-dry-4OMP-C12_MG" %}

    {% do task_dict.update({
        "app_name": "jedi_tlm_tests",
        "opt_confs": ["nwp_gal9_c12", "rrt_equals_dt", "semi_strict_solver", "dry"],
        "resolution": "C12_MG",
        "ancil_resolution": "C12",
        "DT": 1800,
        "tsteps": 13,
        "mpi_parts": 6,
        "threads": 4,
    }) %}

{% elif task_ns.conf_name == "tlm_tests_nwp_gal9-dry-1PE-4OMP-C12_MG" %}

    {% do task_dict.update({
        "app_name": "jedi_tlm_tests",
        "opt_confs": ["nwp_gal9_c12", "rrt_equals_dt", "semi_strict_solver", "dry"],
        "resolution": "C12_MG",
        "ancil_resolution": "C12",
        "DT": 1800,
        "tsteps": 13,
        "mpi_parts": 1,
        "threads": 4,
    }) %}

{% elif task_ns.conf_name == "tlm_forecast_tl_nwp_gal9-C12_MG_op" %}
    {% do task_dict.update({
        "app_name": "jedi_tlm_forecast_tl",
        "opt_confs": ["nwp_gal9_c12", "rrt_equals_dt", "semi_strict_solver"],
        "resolution": "C12_MG_op",
        "ancil_resolution": "C12",
        "DT": 1800,
        "tsteps": 13,
        "mpi_parts": 6,
    }) %}

{% elif task_ns.conf_name == "tlm_tests_nwp_gal9-C12_MG_op" %}
    {% do task_dict.update({
        "app_name": "jedi_tlm_tests",
        "opt_confs": ["nwp_gal9_c12", "rrt_equals_dt", "semi_strict_solver"],
        "resolution": "C12_MG_op",
        "ancil_resolution": "C12",
        "DT": 1800,
        "tsteps": 13,
        "mpi_parts": 6,
    }) %}

{% elif task_ns.conf_name == "tlm_tests_nwp_gal9-strict_solver-4OMP-C12_MG" %}

    {% do task_dict.update({
        "app_name": "jedi_tlm_tests",
        "opt_confs": ["nwp_gal9_c12", "rrt_equals_dt", "strict_solver"],
        "resolution": "C12_MG",
        "ancil_resolution": "C12",
        "DT": 1800,
        "tsteps": 13,
        "mpi_parts": 6,
        "threads": 4,
    }) %}

{% elif task_ns.conf_name == "tlm_tests_nwp_gal9-4OMP-C224_MG" %}

    {% do task_dict.update({
        "app_name": "jedi_tlm_tests",
        "opt_confs": ["nwp_gal9_c224", "rrt_equals_dt", "semi_strict_solver"],
        "resolution": "C224_MG",
        "ancil_resolution": "C224",
        "DT": 1800,
        "tsteps": 13,
        "mpi_parts": 1176,
        "threads": 4,
    }) %}

{% elif task_ns.conf_name == "tlm_tests_nwp_gal9-real_increment-4OMP-C224_MG" %}

    {% do task_dict.update({
        "app_name": "jedi_tlm_tests",
        "opt_confs": ["nwp_gal9_c224", "rrt_equals_dt", "real_increment", "semi_strict_solver"],
        "resolution": "C224_MG",
        "ancil_resolution": "C224",
        "DT": 1800,
        "tsteps": 13,
        "mpi_parts": 1176,
        "threads": 4,
    }) %}

{% elif task_ns.conf_name == "tlm_tests_nwp_gal9-strict_solver-4OMP-C224_MG" %}

    {% do task_dict.update({
        "app_name": "jedi_tlm_tests",
        "opt_confs": ["nwp_gal9_c224", "rrt_equals_dt", "strict_solver"],
        "resolution": "C224_MG",
        "ancil_resolution": "C224",
        "DT": 1800,
        "tsteps": 13,
        "mpi_parts": 1176,
        "threads": 4,
    }) %}

{% elif task_ns.conf_name == "integration_tests" %}

    {% do task_dict.update({
        "placeholder": true,
    }) %}

{% elif task.startswith("build") %}

    {% do task_dict.update({
        "wallclock": 30,
    }) %}

{% endif %}


{# Set default values #}
{% if task_dict %}
    {% do task_dict.update({"application_dir": "lfric_apps/applications/jedi_lfric_tests"}) %}
    {% if "app_name" not in task_dict %}
        {% do task_dict.update({"app_name": "jedi_lfric_tests"}) %}
    {% endif %}

    {# List of configuration names that have no kgo #}
    {% set no_kgo = [
        "id_tlm_tests_nwp_gal9-C12_MG",
        "id_tlm_tests_nwp_gal9-1PE-C12_MG",
        "tlm_tests_nwp_gal9-C12_MG",
        "tlm_tests_nwp_gal9-C12_MG_op",
        "tlm_tests_nwp_gal9-1PE-C12_MG",
        "tlm_tests_nwp_gal9-4OMP-C12_MG",
        "tlm_tests_nwp_gal9-real_increment-4OMP-C12_MG",
        "tlm_tests_nwp_gal9-1PE-4OMP-C12_MG",
        "tlm_tests_nwp_gal9-dry-C12_MG",
        "tlm_tests_nwp_gal9-dry-4OMP-C12_MG",
        "tlm_tests_nwp_gal9-dry-1PE-C12_MG",
        "tlm_tests_nwp_gal9-dry-1PE-4OMP-C12_MG",
        "tlm_tests_nwp_gal9-strict_solver-4OMP-C12_MG",
        "tlm_tests_nwp_gal9-4OMP-C224_MG",
        "tlm_tests_nwp_gal9-real_increment-4OMP-C224_MG",
        "tlm_tests_nwp_gal9-strict_solver-4OMP-C224_MG"
    ] %}

    {% if task_ns.conf_name not in no_kgo %}
        {% if "kgo_checks" not in task_dict %}
            {% do task_dict.update({"kgo_checks": ["checksum"]}) %}
        {% endif %}
    {% endif %}
{% endif %}

{% do LOG.debug("Finished in site/common/jedi_lfric_tests/tasks_jedi_lfric_tests.cylc") %}
