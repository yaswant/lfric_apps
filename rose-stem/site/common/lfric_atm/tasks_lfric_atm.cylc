{# ########################################################################### #}
{# (c) Crown copyright 2024 Met Office. All rights reserved. #}
{# The file LICENCE, distributed with this code, contains details of the terms #}
{# under which the code may be used. #}
{# ########################################################################### #}
{% do LOG.debug("Entered site/common/lfric_atm/tasks_lfric_atm.cylc") %}

{# ###################################################################### #}
{# Global NWP jobs #}
{# ###################################################################### #}

{% if task_ns.conf_name == "nwp_gal9-C12" %}

    {% do task_dict.update({
        "opt_confs": ["um_dump"],
        "resolution": "C12",
        "DT": 1800,
        "tsteps": 144,
        "crun": 2,
        "crun_compare": false,
        "mpi_parts": 6,
        "kgo_checks": ["checksum"],
        "plot_str": "plot_map.py $NODAL_DATA_DIR/lfric_diagnostics.nc  $PLOT_DIR",
    }) %}

{% elif task_ns.conf_name == "nwp_gal9-C48_MG" %}

    {% do task_dict.update({
        "opt_confs": ["um_dump","test_diags"],
        "resolution": "C48_MG",
        "DT": 1800,
        "tsteps": 36,
        "mpi_parts": 24,
        "kgo_checks": ["checksum"],
        "plot_str": "plot_map.py $NODAL_DATA_DIR/lfric_diagnostics.nc  $PLOT_DIR",
        "memory_plot_ex": true,
    }) %}

{% elif task_ns.conf_name == "nwp_gal9_ragged-C48_MG" %}

    {% do task_dict.update({
        "opt_confs": ["um_dump","test_diags","physics_segmentation"],
        "resolution": "C48_MG",
        "DT": 1800,
        "tsteps": 36,
        "mpi_parts": 30,
        "kgo_checks": ["checksum"],
        "plot_str": "plot_map.py $NODAL_DATA_DIR/lfric_diag.nc  $PLOT_DIR",
        "memory_plot_ex": true,
        "panel_decomp": "auto_nonuniform",
    }) %}

{% elif task_ns.conf_name == "nwp_gal9_deep-C48_MG" %}

    {% do task_dict.update({
        "opt_confs": ["um_dump","deep","test_diags","physics_segmentation"],
        "resolution": "C48_MG",
        "DT": 1800,
        "tsteps": 36,
        "mpi_parts": 24,
        "kgo_checks": ["checksum"],
        "plot_str": "plot_map.py $NODAL_DATA_DIR/lfric_diag.nc  $PLOT_DIR",
    }) %}

{% elif task_ns.conf_name == "nwp_gal9_nomg-C48" %}

    {% do task_dict.update({
        "opt_confs": ["nwp_gal9_nomg"],
        "resolution": "C48",
        "DT": 1800,
        "tsteps": 36,
        "mpi_parts": 24,
        "kgo_checks": ["checksum"],
        "plot_str": "plot_map.py $NODAL_DATA_DIR/lfric_diag.nc  $PLOT_DIR",
    }) %}

{% elif task_ns.conf_name == "nwp_gal9-pert-C12" %}

    {% do task_dict.update({
        "opt_confs": ["um_dump","test_diags1", "perturb"],
        "resolution": "C12",
        "DT": 1800,
        "tsteps": 10,
        "mpi_parts": 6,
        "kgo_checks": ["checksum"],
        "plot_str": "plot_map.py $NODAL_DATA_DIR/lfric_diag.nc  $PLOT_DIR",
        "pert_compare": true,
        "pert_plot_str": "l2_time_series.py $PERT_ON_TASK/results/ $PERT_OFF_TASK/results/ \
                          $PLOT_DIR T000000:T000001.8:T000003.6:T000005.4:T000007.2:T000009.0:T000010.8:T000012.6:T000014.4:T000016.2:T000018 \
                          theta",
    }) %}

{% elif task_ns.conf_name == "nwp_gal9_1T-C12" %}
    {% do task_dict.update({
        "opt_confs": ["physics_segmentation","um_dump","no_diags"],
        "resolution": "C12",
        "DT": 1800,
        "tsteps": 36,
        "mpi_parts": 24,
        "threads": 1,
        "kgo_checks": ["checksum"],
    }) %}

    {%  if task_ns.compiler == "gnu" %}
        {% do task_dict.update({"kgo_checks": []}) %}
    {% endif %}

{% elif task_ns.conf_name == "nwp_gal9_2T-C12" %}
    {% do task_dict.update({
        "opt_confs": ["physics_segmentation","um_dump","no_diags"],
        "resolution": "C12",
        "DT": 1800,
        "tsteps": 36,
        "mpi_parts": 12,
        "threads": 2,
        "kgo_checks": ["checksum"],
    }) %}

    {%  if task_ns.compiler == "gnu" %}
        {% do task_dict.update({"kgo_checks": []}) %}
    {% endif %}

{% elif task_ns.conf_name == "nwp_gal9_1T-C48_MG" %}
    {% do task_dict.update({
        "opt_confs": ["physics_segmentation","um_dump","no_diags"],
        "resolution": "C48_MG",
        "DT": 1800,
        "tsteps": 36,
        "mpi_parts": 24,
        "threads": 1,
        "memory": [40, "GB"],
        "kgo_checks": ["checksum"],
    }) %}

    {%  if task_ns.compiler == "gnu" %}
        {% do task_dict.update({"kgo_checks": []}) %}
    {% endif %}

{% elif task_ns.conf_name == "nwp_gal9_2T-C48_MG" %}
    {% do task_dict.update({
        "opt_confs": ["physics_segmentation","um_dump","no_diags"],
        "resolution": "C48_MG",
        "DT": 1800,
        "tsteps": 36,
        "mpi_parts": 12,
        "threads": 2,
        "memory": [40, "GB"],
        "kgo_checks": ["checksum"],
    }) %}

    {%  if task_ns.compiler == "gnu" %}
        {% do task_dict.update({"kgo_checks": []}) %}
    {% endif %}

{% elif task_ns.conf_name == "nwp_gal9_4T-C48_MG" %}
    {% do task_dict.update({
        "opt_confs": ["physics_segmentation","um_dump","no_diags"],
        "resolution": "C48_MG",
        "DT": 1800,
        "tsteps": 36,
        "mpi_parts": 6,
        "threads": 4,
        "memory": [40, "GB"],
        "kgo_checks": ["checksum"],
    }) %}

    {%  if task_ns.compiler == "gnu" %}
        {% do task_dict.update({"kgo_checks": []}) %}
    {% endif %}

{% elif task_ns.conf_name == "nwp_gal9_3n_1T-C192_MG" %}

    {% do task_dict.update({
        "opt_confs": ["physics_segmentation","um_dump","no_diags"],
        "resolution": "C192_MG",
        "DT": 720,
        "tsteps": 120,
        "mpi_parts": 384,
        "threads": 1,
    }) %}

{% elif task_ns.conf_name == "nwp_gal9_3n_2T-C192_MG" %}

    {% do task_dict.update({
        "opt_confs": ["physics_segmentation","um_dump","no_diags"],
        "resolution": "C192_MG",
        "DT": 720,
        "tsteps": 120,
        "mpi_parts": 192,
        "task_ranks_per_node": 64,
        "threads": 2,
    }) %}

{% elif task_ns.conf_name == "nwp_gal9_3n_4T-C192_MG" %}

    {% do task_dict.update({
        "opt_confs": ["physics_segmentation","um_dump","no_diags"],
        "resolution": "C192_MG",
        "DT": 720,
        "tsteps": 120,
        "mpi_parts": 96,
        "task_ranks_per_node": 32,
        "threads": 4,
    }) %}

{% elif task_ns.conf_name == "nwp_gal9-C224_MG" %}

    {% do task_dict.update({
        "opt_confs": ["um_dump","june_case"],
        "resolution": "C224_MG",
        "DT": 720,
        "tsteps": 120,
        "mpi_parts": 588,
        "xios_nodes": 1,
        "mpi_parts_xios" : 64,
        "log_level": "info",
        "plot_str": "plot_map.py $NODAL_DATA_DIR/lfric_diagnostics.nc  $PLOT_DIR",
        "memory_plot_ex": true,
    }) %}

{% elif task_ns.conf_name == "nwp_gal9_oper-C224_MG" %}

    {% do task_dict.update({
        "opt_confs": ["um_dump","june_case","oper_diags"],
        "resolution": "C224_MG",
        "DT": 720,
        "tsteps": 60,
        "mpi_parts": 588,
        "xios_nodes": 1,
        "mpi_parts_xios" : 64,
        "log_level": "info",
        "memory_plot_ex": true,
    }) %}

{% elif task_ns.conf_name == "nwp_gal9_debug-C224_MG" %}

    {% do task_dict.update({
        "opt_confs": ["um_dump","june_case","no_diags"],
        "resolution": "C224_MG",
        "DT": 720,
        "tsteps": 6,
        "mpi_parts": 588,
        "xios_nodes": 1,
        "mpi_parts_xios" : 64,
        "log_level": "error",
    }) %}

{% elif task_ns.conf_name == "nwp_gal9_ls_and_jedi-C224_MG" %}

    {% do task_dict.update({
        "opt_confs": ["um_dump","ls_and_jedi","june_case"],
        "resolution": "C224_MG",
        "DT": 720,
        "tsteps": 35,
        "mpi_parts": 1176,
        "wallclock": 10,
        "xios_nodes": 4,
        "mpi_parts_xios" : 16,
    }) %}

{% elif task_ns.conf_name == "nwp_gal9-C896_MG" %}

    {% do task_dict.update({
        "opt_confs": ["um_dump"],
        "resolution": "C896_MG",
        "DT": 240,
        "tsteps": 120,
        "mpi_parts": 4704,
        "xios_nodes": 4,
        "mpi_parts_xios" : 32,
        "log_level": "info",
        "plot_str": "plot_map.py $NODAL_DATA_DIR/lfric_diagnostics.nc  $PLOT_DIR",
    }) %}

{% elif task_ns.conf_name == "nwp_gal9_coarse_aero-C48_MG" %}

    {% do task_dict.update({
        "opt_confs": ["coarse_aero","um_dump"],
        "resolution": "C48_MG",
        "DT": 1800,
        "tsteps": 36,
        "mpi_parts": 24,
        "kgo_checks": ["checksum"],
        "plot_str": "plot_map.py $NODAL_DATA_DIR/lfric_diagnostics.nc  $PLOT_DIR",
    }) %}

{% elif task_ns.conf_name == "nwp_gal9_coarse_aero_threaded-C48_MG" %}

    {% do task_dict.update({
        "opt_confs": ["no_dust","coarse_aero","um_dump","physics_segmentation"],
        "resolution": "C48_MG",
        "DT": 1800,
        "tsteps": 36,
        "mpi_parts": 12,
        "threads": 2,
        "kgo_checks": ["checksum"],
    }) %}

{% elif task_ns.conf_name == "nwp_gal9_da-C12" %}

    {% do task_dict.update({
        "opt_confs": ["da"],
        "resolution": "C12",
        "DT": 1800,
        "tsteps": 144,
        "crun": 2,
        "crun_compare": false,
        "mpi_parts": 6,
        "kgo_checks": ["checksum"],
        "plot_str": "plot_map.py $NODAL_DATA_DIR/lfric_diagnostics.nc  $PLOT_DIR",
    }) %}

{% elif task_ns.conf_name == "nwp_gal9_eda-C12" %}

    {% do task_dict.update({
        "opt_confs": ["eda"],
        "resolution": "C12",
        "DT": 1800,
        "tsteps": 144,
        "crun": 2,
        "crun_compare": false,
        "mpi_parts": 6,
        "kgo_checks": ["checksum"],
        "plot_str": "plot_map.py $NODAL_DATA_DIR/lfric_diagnostics.nc  $PLOT_DIR",
    }) %}

{% elif task_ns.conf_name == "nwp_gal9_eda_jada-C12" %}

    {% do task_dict.update({
        "opt_confs": ["eda_jada"],
        "resolution": "C12",
        "DT": 1800,
        "tsteps": 144,
        "crun": 2,
        "crun_compare": false,
        "mpi_parts": 6,
        "kgo_checks": ["checksum"],
        "plot_str": "plot_map.py $NODAL_DATA_DIR/lfric_diagnostics.nc  $PLOT_DIR",
    }) %}

{% elif task_ns.conf_name == "nwp_gal9_ls_and_jedi-C12" %}

    {% do task_dict.update({
        "opt_confs": ["um_dump","ls_and_jedi"],
        "resolution": "C12",
        "DT": 1800,
        "tsteps": 14,
        "mpi_parts": 6,
    }) %}

{% elif task_ns.conf_name == "nwp_gal9_mol-C12" %}

    {% do task_dict.update({
        "opt_confs": ["mol","um_dump"],
        "resolution": "C12",
        "DT": 1800,
        "tsteps": 144,
        "crun": 2,
        "crun_compare": false,
        "mpi_parts": 6,
        "kgo_checks": ["checksum"],
        "plot_str": "plot_map.py $NODAL_DATA_DIR/lfric_diagnostics.nc  $PLOT_DIR",
    }) %}

{% elif task_ns.conf_name == "nwp_casim-C12" %}

    {% do task_dict.update({
        "opt_confs": ["casim","um_dump"],
        "resolution": "C12",
        "DT": 1800,
        "tsteps": 144,
        "crun": 2,
        "crun_compare": false,
        "mpi_parts": 6,
        "kgo_checks": ["checksum"],
        "plot_str": "plot_map.py $NODAL_DATA_DIR/lfric_diagnostics.nc  $PLOT_DIR",
    }) %}

{% elif task_ns.conf_name == "nwp_coma9-C12" %}

    {% do task_dict.update({
        "opt_confs": ["coma9","um_dump"],
        "resolution": "C12",
        "DT": 1800,
        "tsteps": 144,
        "crun": 2,
        "crun_compare": false,
        "mpi_parts": 6,
        "kgo_checks": ["checksum"],
        "plot_str": "plot_map.py $NODAL_DATA_DIR/lfric_diagnostics.nc  $PLOT_DIR",
    }) %}

{% elif task_ns.conf_name == "nwp_comorph_tb-C12" %}

    {% do task_dict.update({
        "opt_confs": ["coma9","comatb","um_dump"],
        "resolution": "C12",
        "DT": 1800,
        "tsteps": 144,
        "crun": 2,
        "crun_compare": false,
        "mpi_parts": 6,
        "kgo_checks": ["checksum"],
        "plot_str": "plot_map.py $NODAL_DATA_DIR/lfric_diagnostics.nc  $PLOT_DIR",
    }) %}

{% elif task_ns.conf_name == "nwp_comorph_dev-C12" %}

    {% do task_dict.update({
        "opt_confs": ["comorph_dev","um_dump"],
        "resolution": "C12",
        "DT": 1800,
        "tsteps": 144,
        "crun": 2,
        "crun_compare": false,
        "mpi_parts": 6,
        "kgo_checks": ["checksum"],
        "plot_str": "plot_map.py $NODAL_DATA_DIR/lfric_diagnostics.nc  $PLOT_DIR",
    }) %}

{% elif task_ns.conf_name == "nwp_gal9_debug-C12" %}

    {% do task_dict.update({
        "opt_confs": ["um_dump","no_diags"],
        "resolution": "C12",
        "DT": 1800,
        "tsteps": 4,
        "mpi_parts": 6,
        "log_level": "info",
        "kgo_checks": ["checksum"],
    }) %}

{% elif task_ns.conf_name == "nwp_gal9_debug-C48_MG" %}

    {% do task_dict.update({
        "opt_confs": ["um_dump","no_diags"],
        "resolution": "C48_MG",
        "DT": 1800,
        "tsteps": 4,
        "mpi_parts": 24,
        "log_level": "info",
        "kgo_checks": ["checksum"],
    }) %}

{% elif task_ns.conf_name == "nwp_gal9_short-C12" %}

    {% do task_dict.update({
        "opt_confs": ["um_dump","no_diags"],
        "resolution": "C12",
        "DT": 1800,
        "tsteps": 2,
        "crun": 2,
        "mpi_parts": 6,
        "kgo_checks": ["checksum"],
    }) %}

{# Share Global Configurations - extended by Performance setups#}
{% elif task_ns.conf_name.startswith("nwp_gal9-C896_MG") %}

    {% do task_dict.update({
        "CXI_MATCH_hybrid": true,
        "opt_confs": ["um_dump"],
        "resolution": "C896_MG",
        "DT": 240,
        "tsteps": 120,
        "wallclock": 15,
        "mpi_parts": 4704,
        "xios_nodes": 4,
        "mpi_parts_xios" : 128,
        "log_level": "info",
        "log_to_rank_zero_only": ".true.",
        "memory_plot_ex": true,
        "plot_str": "plot_map.py $NODAL_DATA_DIR/lfric_diagnostics.nc  $PLOT_DIR",
    }) %}

{# ###################################################################### #}
{# Global Climate jobs #}
{# ###################################################################### #}

{% elif task_ns.conf_name == "clim_gal9-C12" %}

    {% do task_dict.update({
        "opt_confs": ["climate","lowres_stp","um_dump"],
        "resolution": "C12",
        "DT": 1800,
        "tsteps": 144,
        "crun": 2,
        "crun_compare": false,
        "mpi_parts": 6,
        "kgo_checks": ["checksum"],
        "plot_str": "plot_map.py -encorr $NODAL_DATA_DIR/lfric_diagnostics.nc  $PLOT_DIR",
    }) %}

{% elif task_ns.conf_name == "clim_gal9-C48_MG" %}

    {% do task_dict.update({
        "opt_confs": ["climate","um_dump"],
        "resolution": "C48_MG",
        "DT": 1800,
        "tsteps": 1440,
        "crun": 2,
        "crun_compare": false,
        "mpi_parts": 216,
        "log_level": "info",
        "wallclock": 30,
        "plot_str": "plot_map.py -encorr $NODAL_DATA_DIR/lfric_diagnostics.nc  $PLOT_DIR",
    }) %}

{% elif task_ns.conf_name == "clim_gal9_1T-C12" %}
    {% do task_dict.update({
        "opt_confs": ["climate", "physics_segmentation","um_dump","no_diags"],
        "resolution": "C12",
        "DT": 1800,
        "tsteps": 48,
        "mpi_parts": 12,
        "threads": 1,
        "memory": [32, "GB"],
        "kgo_checks": ["checksum"],
    }) %}

    {% if task_ns.compiler == "gnu" %}
       {% do task_dict.update({"kgo_checks": []}) %}
    {% endif %}

{% elif task_ns.conf_name == "clim_gal9_2T-C12" %}
    {% do task_dict.update({
        "opt_confs": ["climate","physics_segmentation","um_dump","no_diags"],
        "resolution": "C12",
        "DT": 1800,
        "tsteps": 48,
        "mpi_parts": 6,
        "threads": 2,
        "memory": [32, "GB"],
        "kgo_checks": ["checksum"],
    }) %}

    {% if task_ns.compiler == "gnu" %}
       {% do task_dict.update({"kgo_checks": []}) %}
    {% endif %}

{% elif task_ns.conf_name == "clim_gal9_1T-C48_MG" %}

    {% do task_dict.update({
        "opt_confs": ["climate","physics_segmentation","um_dump","no_diags"],
        "resolution": "C48_MG",
        "DT": 1800,
        "tsteps": 12,
        "threads": 1,
        "mpi_parts": 24,
        "memory": [230,"GB"],
        "kgo_checks": ["checksum"],
    }) %}

    {% if task_ns.compiler == "gnu" %}
       {% do task_dict.update({"kgo_checks": []}) %}
    {% endif %}

{% elif task_ns.conf_name == "clim_gal9_2T-C48_MG" %}

    {% do task_dict.update({
        "opt_confs": ["climate","physics_segmentation","um_dump","no_diags"],
        "resolution": "C48_MG",
        "DT": 1800,
        "tsteps": 12,
        "threads": 2,
        "mpi_parts": 12,
        "memory": [230,"GB"],
        "kgo_checks": ["checksum"],
    }) %}

    {% if task_ns.compiler == "gnu" %}
       {% do task_dict.update({"kgo_checks": []}) %}
    {% endif %}

{% elif task_ns.conf_name == "clim_gal9_4T-C48_MG" %}

    {% do task_dict.update({
        "opt_confs": ["climate","physics_segmentation","um_dump","no_diags"],
        "resolution": "C48_MG",
        "DT": 1800,
        "tsteps": 12,
        "threads": 4,
        "mpi_parts": 6,
        "memory": [230,"GB"],
        "kgo_checks": ["checksum"],
    }) %}

    {% if task_ns.compiler == "gnu" %}
       {% do task_dict.update({"kgo_checks": []}) %}
    {% endif %}

{% elif task_ns.conf_name == "clim_gal9_chem-C12" %}

    {% do task_dict.update({
        "opt_confs": ["climate","chemistry","lowres_stp","um_dump"],
        "resolution": "C12",
        "DT": 1800,
        "tsteps": 144,
        "crun": 2,
        "crun_compare": false,
        "mpi_parts": 6,
        "kgo_checks": ["checksum"],
        "plot_str": "plot_map.py -encorr $NODAL_DATA_DIR/lfric_diagnostics.nc  $PLOT_DIR",
    }) %}

{% elif task_ns.conf_name == "clim_gal9_chem_1T-C12" %}
    {% do task_dict.update({
        "opt_confs": ["climate","chemistry", "lowres_stp","physics_segmentation","um_dump","no_diags"],
        "resolution": "C12",
        "DT": 1800,
        "tsteps": 48,
        "mpi_parts": 12,
        "threads": 1,
        "memory": [30, "GB"],
        "kgo_checks": ["checksum"],
    }) %}

    {% if task_ns.compiler == "gnu" %}
       {% do task_dict.update({"kgo_checks": []}) %}
    {% endif %}

{% elif task_ns.conf_name == "clim_gal9_chem_2T-C12" %}
    {% do task_dict.update({
        "opt_confs": ["climate","chemistry","lowres_stp","physics_segmentation","um_dump","no_diags"],
        "resolution": "C12",
        "DT": 1800,
        "tsteps": 48,
        "mpi_parts": 6,
        "threads": 2,
        "memory": [40, "GB"],
        "kgo_checks": ["checksum"],
    }) %}

    {% if task_ns.compiler == "gnu" %}
       {% do task_dict.update({"kgo_checks": []}) %}
    {% endif %}

{# ###################################################################### #}
{# Regional jobs #}
{# ###################################################################### #}

{% elif task_ns.conf_name == "ral3-seuk_MG" %}

    {% do task_dict.update({
        "opt_confs": ["l70_40km","ral3","ral_opts","hh_solve"],
        "resolution": "seuk_MG",
        "DT": 60,
        "tsteps": 120,
        "crun": 2,
        "crun_compare": false,
        "mpi_parts": 16,
        "kgo_checks": ["checksum"],
        "plot_str": "plot_map.py -ral $NODAL_DATA_DIR/lfric_diagnostics.nc  $PLOT_DIR",
    }) %}

{% elif task_ns.conf_name == "ral3-seuk_ls_and_jedi" %}

    {% do task_dict.update({
        "opt_confs": ["l70_40km","ral3","ral_opts","hh_solve","ral_ls_and_jedi"],
        "resolution": "seuk_MG",
        "DT": 60,
        "tsteps": 120,
        "crun": 1,
        "crun_compare": false,
        "mpi_parts": 16,
    }) %}

{% elif task_ns.conf_name == "ral3-uk_MG" %}

    {% do task_dict.update({
        "opt_confs": ["l70_40km","ral3","ral_opts","murk","hh_solve"],
        "resolution": "uk_MG",
        "DT": 60,
        "tsteps": 360,
        "crun": 2,
        "crun_compare": false,
        "mpi_parts": 729,
        "xios_nodes": 3,
        "mpi_parts_xios" : 96,
        "log_level": "info",
        "wallclock": 30,
        "plot_str": "plot_map.py -ral $NODAL_DATA_DIR/lfric_diagnostics.nc  $PLOT_DIR",
    }) %}

{% elif task_ns.conf_name == "ral3-uk_672_MG" %}

    {% do task_dict.update({
        "opt_confs": ["l70_40km","ral3","ral_opts","hh_solve"],
        "resolution": "uk_672x672_MG",
        "DT": 60,
        "tsteps": 180,
        "crun": 1,
        "crun_compare": false,
        "mpi_parts": 784,
        "xios_nodes": 2,
        "mpi_parts_xios" : 64,
        "log_level": "info",
        "plot_str": "plot_map.py -ral $NODAL_DATA_DIR/lfric_diagnostics.nc  $PLOT_DIR",
    }) %}

{% elif task_ns.conf_name == "ral3-ukv_MG" %}

    {% do task_dict.update({
        "opt_confs": ["l70_40km","ral3","ral_opts","hh_solve"],
        "resolution": "ukv_MG",
        "DT": 60,
        "tsteps": 360,
        "mpi_parts": 2560,
        "xios_nodes": 4,
        "mpi_parts_xios" : 128,
        "log_level": "info",
        "wallclock": 60,
        "plot_str": "plot_map.py -ral $NODAL_DATA_DIR/lfric_diagnostics.nc  $PLOT_DIR",
    }) %}

{% elif task_ns.conf_name == "ral3-melbourne_MG" %}

    {% do task_dict.update({
        "opt_confs": ["l70_40km","ral3","ral_opts","hh_solve"],
        "resolution": "melbourne_MG",
        "DT": 60,
        "tsteps": 360,
        "crun": 2,
        "crun_compare": false,
        "mpi_parts": 256,
        "xios_nodes": 1,
        "mpi_parts_xios" : 32,
        "log_level": "info",
        "plot_str": "plot_map.py -ral $NODAL_DATA_DIR/lfric_diagnostics.nc  $PLOT_DIR",
    }) %}

{% elif task_ns.conf_name == "ral3_ens-seuk_MG" %}

    {% do task_dict.update({
        "opt_confs": ["l70_40km","ral3","ral3_ens","ral_opts","hh_solve"],
        "resolution": "seuk_MG",
        "DT": 60,
        "tsteps": 120,
        "crun": 2,
        "crun_compare": false,
        "mpi_parts": 16,
        "kgo_checks": ["checksum"],
        "plot_str": "plot_map.py -ral $NODAL_DATA_DIR/lfric_diagnostics.nc  $PLOT_DIR",
    }) %}

{% elif task_ns.conf_name == "ral3_mixmol-seuk_MG" %}

    {% do task_dict.update({
        "opt_confs": ["l70_40km","ral3","mol","ral_mixmol_opts"],
        "resolution": "seuk_MG",
        "DT": 60,
        "tsteps": 120,
        "crun": 2,
        "crun_compare": false,
        "mpi_parts": 16,
        "kgo_checks": ["checksum"],
        "plot_str": "plot_map.py -ral $NODAL_DATA_DIR/lfric_diagnostics.nc  $PLOT_DIR",
    }) %}

{% elif task_ns.conf_name == "ral3_mixmol-uk_MG" %}

    {% do task_dict.update({
        "opt_confs": ["l70_40km","ral3","mol","ral_mixmol_opts"],
        "resolution": "uk_MG",
        "DT": 60,
        "tsteps": 360,
        "crun": 2,
        "crun_compare": false,
        "mpi_parts": 729,
        "xios_nodes": 2,
        "mpi_parts_xios" : 64,
        "log_level": "info",
        "plot_str": "plot_map.py -ral $NODAL_DATA_DIR/lfric_diagnostics.nc  $PLOT_DIR",
    }) %}

{# ###################################################################### #}
{# Idealised jobs #}
{# ###################################################################### #}

{% elif task_ns.conf_name == "rce-BiP64x64-1500x1500_MG" %}

    {% do task_dict.update({
        "opt_confs": ["l70_40km","ral3","hh_solve","no_aerosol","rce"],
        "resolution": "BiP64x64-1500x1500_MG",
        "DT": 60,
        "tsteps": 120,
        "mpi_parts": 16,
        "memory": [8, "GB"],
        "kgo_checks": ["checksum"],
        "plot_str": "plot_rce.py $NODAL_DATA_DIR/lfric_diagnostics.nc  $PLOT_DIR",
    }) %}

{% elif task_ns.conf_name == "comp_tran_ref_3d_l120-BiP64x64-1500x1500_MG" %}

    {% do task_dict.update({
        "opt_confs": ["l120_40km","ral3","hh_solve","no_aerosol","comp_tran_ref","3dIdeal"],
        "resolution": "BiP64x64-1500x1500_MG",
        "DT": 60,
        "tsteps": 1440,
        "mpi_parts": 64,
        "kgo_checks": ["checksum"],
        "log_level": "info",
    }) %}

{% elif task_ns.conf_name == "aquaplanet-C12" %}

    {% do task_dict.update({
        "opt_confs": ["l38_40km_user_eta","no_aerosol","aquaplanet"],
        "resolution": "C12",
        "DT": 1800,
        "tsteps": 24,
        "crun": 2,
        "crun_compare": false,
        "mpi_parts": 6,
        "kgo_checks": ["checksum"],
        "plot_str": "plot_map.py $NODAL_DATA_DIR/lfric_diagnostics.nc  $PLOT_DIR",
    }) %}

{% elif task_ns.conf_name == "hd209458b-C24" %}

    {% do task_dict.update({
        "opt_confs": ["l66_9000km", "hd209458b"],
        "resolution": "C24_MG",
        "DT": 30,
        "tsteps": 120,
        "crun": 2,
        "crun_compare": false,
        "mpi_parts": 6,
        "kgo_checks": ["checksum"],
        "log_level": "info",
    }) %}

{% elif task_ns.conf_name == "camembert_case3_gj1214b-C12" %}

    {% do task_dict.update({
        "opt_confs": ["l66_4000km","camembert_case3_gj1214b"],
        "resolution": "C12",
        "DT": 1800,
        "tsteps": 24,
        "crun": 2,
        "crun_compare": false,
        "mpi_parts": 6,
        "kgo_checks": ["checksum"],
        "plot_str": "plot_map.py $NODAL_DATA_DIR/lfric_diagnostics.nc  $PLOT_DIR",
    }) %}

{% elif task_ns.conf_name == "thai_ben1-C48_MG" %}

    {% do task_dict.update({
        "opt_confs": ["l38_40km","thai","dry_atm"],
        "resolution": "C48_MG",
        "DT": 1200,
        "tsteps": 72,
        "mpi_parts": 24,
        "kgo_checks": ["checksum"],
        "log_level": "info",
        "plot_str": "plot_map.py $NODAL_DATA_DIR/lfric_diagnostics.nc  $PLOT_DIR",
    }) %}

{# ###################################################################### #}
{# Single column jobs #}
{# ###################################################################### #}

{% elif task_ns.conf_name == "scm_gal9_bomex-BiP2x2-50000x50000" %}

    {% do task_dict.update({
        "opt_confs": ["l85_85km","no_aerosol","bomex"],
        "resolution": "BiP2x2-50000x50000",
        "DT": 1200,
        "tsteps": 72,
        "wallclock": 5,
        "kgo_checks": ["checksum"],
        "plot_str": "plot_scm.py $NODAL_DATA_DIR/lfric_diagnostics.nc  $PLOT_DIR",
    }) %}

{% elif task_ns.conf_name == "scm_coma9_bomex-BiP2x2-50000x50000" %}

    {% do task_dict.update({
        "opt_confs": ["l85_85km","coma9","no_aerosol","bomex"],
        "resolution": "BiP2x2-50000x50000",
        "DT": 1200,
        "tsteps": 72,
        "wallclock": 5,
        "kgo_checks": ["checksum"],
        "plot_str": "plot_scm.py $NODAL_DATA_DIR/lfric_diagnostics.nc  $PLOT_DIR",
    }) %}

{% elif task_ns.conf_name == "scm_comorph_dev_bomex-BiP2x2-50000x50000" %}

    {% do task_dict.update({
        "opt_confs": ["l85_85km","comorph_dev","no_aerosol","bomex"],
        "resolution": "BiP2x2-50000x50000",
        "DT": 1200,
        "tsteps": 72,
        "wallclock": 5,
        "kgo_checks": ["checksum"],
        "plot_str": "plot_scm.py $NODAL_DATA_DIR/lfric_diagnostics.nc  $PLOT_DIR",
    }) %}

{% elif task_ns.conf_name == "scm_gal9_cbl-BiP2x2-50000x50000" %}

    {% do task_dict.update({
        "opt_confs": ["l70_40km","no_aerosol","cbl"],
        "resolution": "BiP2x2-50000x50000",
        "DT": 600,
        "tsteps": 48,
        "wallclock": 5,
        "plot_str": "plot_scm.py $NODAL_DATA_DIR/lfric_diagnostics.nc  $PLOT_DIR",
    }) %}

{% elif task_ns.conf_name == "scm_gal9_cbl_dry-BiP2x2-50000x50000" %}

    {% do task_dict.update({
        "opt_confs": ["l70_40km","no_aerosol","cbl_dry"],
        "resolution": "BiP2x2-50000x50000",
        "DT": 600,
        "tsteps": 48,
        "wallclock": 5,
        "kgo_checks": ["checksum"],
        "plot_str": "plot_scm.py $NODAL_DATA_DIR/lfric_diag.nc  $PLOT_DIR",
    }) %}

{% elif task_ns.conf_name == "scm_gal9_comp_tran_ref-BiP2x2-50000x50000" %}

    {% do task_dict.update({
        "opt_confs": ["l70_40km","no_aerosol","comp_tran_ref"],
        "resolution": "BiP2x2-50000x50000",
        "DT": 1200,
        "tsteps": 216,
        "wallclock": 5,
        "kgo_checks": ["checksum"],
        "plot_str": "plot_scm.py $NODAL_DATA_DIR/lfric_diagnostics.nc  $PLOT_DIR",
    }) %}

{% elif task_ns.conf_name == "scm_gal9_constrain-BiP2x2-50000x50000" %}

    {% do task_dict.update({
        "opt_confs": ["l70_40km","no_aerosol","constrain"],
        "resolution": "BiP2x2-50000x50000",
        "DT": 900,
        "tsteps": 56,
        "wallclock": 5,
        "plot_str": "plot_scm.py $NODAL_DATA_DIR/lfric_diagnostics.nc  $PLOT_DIR",
    }) %}

{% elif task_ns.conf_name == "scm_gal9_dice2-BiP2x2-50000x50000" %}

    {% do task_dict.update({
        "opt_confs": ["l70_40km","no_aerosol","dice2"],
        "resolution": "BiP2x2-50000x50000",
        "DT": 600,
        "tsteps": 432,
        "wallclock": 5,
        "kgo_checks": ["checksum"],
        "plot_str": "plot_scm.py $NODAL_DATA_DIR/lfric_diagnostics.nc  $PLOT_DIR",
    }) %}

{% elif task_ns.conf_name == "scm_gal9_gabls4-BiP2x2-50000x50000" %}

    {% do task_dict.update({
        "opt_confs": ["l70_40km","no_aerosol","gabls4"],
        "resolution": "BiP2x2-50000x50000",
        "DT": 60,
        "tsteps": 2160,
        "wallclock": 5,
        "kgo_checks": ["checksum"],
        "plot_str": "plot_scm.py $NODAL_DATA_DIR/lfric_diagnostics.nc  $PLOT_DIR",
    }) %}

{% elif task_ns.conf_name == "scm_gal9_sahara-BiP2x2-50000x50000" %}

    {% do task_dict.update({
        "opt_confs": ["l70_40km","no_aerosol","sahara"],
        "resolution": "BiP2x2-50000x50000",
        "DT": 900,
        "tsteps": 36,
        "wallclock": 5,
        "kgo_checks": ["checksum"],
        "plot_str": "plot_scm.py $NODAL_DATA_DIR/lfric_diag.nc  $PLOT_DIR",
    }) %}

{% elif task_ns.conf_name == "scm_gal9_seaice-BiP2x2-50000x50000" %}

    {% do task_dict.update({
        "opt_confs": ["l70_40km","no_aerosol","seaice"],
        "resolution": "BiP2x2-50000x50000",
        "DT": 900,
        "tsteps": 56,
        "wallclock": 5,
        "kgo_checks": ["checksum"],
        "plot_str": "plot_scm.py $NODAL_DATA_DIR/lfric_diag.nc  $PLOT_DIR",
    }) %}

{% elif task_ns.conf_name == "scm_gal9_snow-BiP2x2-50000x50000" %}

    {% do task_dict.update({
        "opt_confs": ["l70_40km","no_aerosol","dice2","snow_init"],
        "resolution": "BiP2x2-50000x50000",
        "DT": 600,
        "tsteps": 432,
        "wallclock": 5,
        "kgo_checks": ["checksum"],
        "plot_str": "plot_scm.py $NODAL_DATA_DIR/lfric_diagnostics.nc  $PLOT_DIR",
    }) %}

{% elif task_ns.conf_name == "scm_gal9_toga-BiP2x2-50000x50000" %}

    {% do task_dict.update({
        "opt_confs": ["l85_85km","no_aerosol","toga"],
        "resolution": "BiP2x2-50000x50000",
        "DT": 1200,
        "tsteps": 1368,
        "wallclock": 5,
        "kgo_checks": ["checksum"],
        "plot_str": "plot_scm.py $NODAL_DATA_DIR/lfric_diagnostics.nc  $PLOT_DIR",
    }) %}

{% elif task_ns.conf_name == "scm_coma9_toga-BiP2x2-50000x50000" %}

    {% do task_dict.update({
        "opt_confs": ["l85_85km","coma9","no_aerosol","toga"],
        "resolution": "BiP2x2-50000x50000",
        "DT": 1200,
        "tsteps": 1368,
        "wallclock": 5,
        "kgo_checks": ["checksum"],
        "plot_str": "plot_scm.py $NODAL_DATA_DIR/lfric_diagnostics.nc  $PLOT_DIR",
    }) %}

{% elif task_ns.conf_name == "scm_comorph_dev_toga-BiP2x2-50000x50000" %}

    {% do task_dict.update({
        "opt_confs": ["l85_85km","comorph_dev","no_aerosol","toga"],
        "resolution": "BiP2x2-50000x50000",
        "DT": 1200,
        "tsteps": 1368,
        "wallclock": 5,
        "kgo_checks": ["checksum"],
        "plot_str": "plot_scm.py $NODAL_DATA_DIR/lfric_diagnostics.nc  $PLOT_DIR",
    }) %}

{% elif task_ns.conf_name == "scm_llcs-BiP2x2-50000x50000" %}

    {% do task_dict.update({
        "opt_confs": ["l85_85km","llcs","no_aerosol","toga"],
        "resolution": "BiP2x2-50000x50000",
        "DT": 1200,
        "tsteps": 48,
        "wallclock": 5,
        "kgo_checks": ["checksum"],
        "plot_str": "plot_scm.py $NODAL_DATA_DIR/lfric_diagnostics.nc  $PLOT_DIR",
    }) %}

{% elif task_ns.conf_name == "scm_rad_gas-BiP2x2-50000x50000" %}

    {% do task_dict.update({
        "opt_confs": ["l70_40km","no_aerosol","rad_gas"],
        "resolution": "BiP2x2-50000x50000",
        "DT": 3600,
        "tsteps": 288,
        "wallclock": 5,
        "kgo_checks": ["checksum"],
        "plot_str": "plot_scm.py $NODAL_DATA_DIR/lfric_diagnostics.nc  $PLOT_DIR",
    }) %}

{% elif task_ns.conf_name == "scm_ral3_comp_tran_ref-BiP2x2-50000x50000" %}

    {% do task_dict.update({
        "opt_confs": ["l70_40km","ral3_scm","no_aerosol","comp_tran_ref"],
        "resolution": "BiP2x2-50000x50000",
        "DT": 1200,
        "tsteps": 216,
        "wallclock": 5,
        "plot_str": "plot_scm.py $NODAL_DATA_DIR/lfric_diagnostics.nc  $PLOT_DIR",
    }) %}

{% elif task_ns.conf_name == "scm_ral3_constrain-BiP2x2-50000x50000" %}

    {% do task_dict.update({
        "opt_confs": ["l70_40km","ral3_scm","no_aerosol","constrain"],
        "resolution": "BiP2x2-50000x50000",
        "DT": 900,
        "tsteps": 56,
        "wallclock": 5,
        "kgo_checks": ["checksum"],
        "plot_str": "plot_scm.py $NODAL_DATA_DIR/lfric_diag.nc  $PLOT_DIR",
    }) %}

{% elif task_ns.conf_name == "scm_ral3_dice2-BiP2x2-50000x50000" %}

    {% do task_dict.update({
        "opt_confs": ["l70_40km","ral3_scm","no_aerosol","dice2"],
        "resolution": "BiP2x2-50000x50000",
        "DT": 600,
        "tsteps": 432,
        "wallclock": 5,
        "plot_str": "plot_scm.py $NODAL_DATA_DIR/lfric_diagnostics.nc  $PLOT_DIR",
    }) %}

{% elif task_ns.conf_name == "scm_ral3_moruses-BiP2x2-50000x50000" %}

    {% do task_dict.update({
        "opt_confs": ["l70_40km","ral3_scm","no_aerosol","dice2","moruses"],
        "resolution": "BiP2x2-50000x50000",
        "DT": 600,
        "tsteps": 432,
        "wallclock": 5,
        "kgo_checks": ["checksum"],
        "plot_str": "plot_scm.py $NODAL_DATA_DIR/lfric_diagnostics.nc  $PLOT_DIR",
    }) %}

{% elif task_ns.conf_name == "scm_ral3_urban2t-BiP2x2-50000x50000" %}

    {% do task_dict.update({
        "opt_confs": ["l70_40km","ral3_scm","no_aerosol","dice2","urban2t"],
        "resolution": "BiP2x2-50000x50000",
        "DT": 600,
        "tsteps": 432,
        "wallclock": 5,
        "kgo_checks": ["checksum"],
        "plot_str": "plot_scm.py $NODAL_DATA_DIR/lfric_diagnostics.nc  $PLOT_DIR",
    }) %}

{% elif task_ns.conf_name == "scm_ukca_land-BiP2x2-50000x50000" %}

    {% do task_dict.update({
        "opt_confs": ["l70_40km","ukca","dice2"],
        "resolution": "BiP2x2-50000x50000",
        "DT": 600,
        "tsteps": 432,
        "crun": 2,
        "wallclock": 5,
        "kgo_checks": ["checksum"],
        "plot_str": "plot_scm.py $NODAL_DATA_DIR/lfric_diagnostics.nc  $PLOT_DIR",
    }) %}

{% elif task_ns.conf_name == "scm_ukca_sea-BiP2x2-50000x50000" %}

    {% do task_dict.update({
        "opt_confs": ["l85_85km","ukca","toga"],
        "resolution": "BiP2x2-50000x50000",
        "DT": 1200,
        "tsteps": 432,
        "crun": 2,
        "wallclock": 5,
        "kgo_checks": ["checksum"],
        "plot_str": "plot_scm.py $NODAL_DATA_DIR/lfric_diagnostics.nc  $PLOT_DIR",
    }) %}

{% elif task_ns.conf_name == "scm_hd209458b-BiP2x2-50000x50000" %}

    {% do task_dict.update({
        "opt_confs": ["l66_9000km", "hd209458b", "scm_45N"],
        "resolution": "BiP2x2-50000x50000",
        "DT": 30,
        "tsteps": 120,
        "wallclock": 5,
        "kgo_checks": ["checksum"],
    }) %}

{% elif task_ns.conf_name == "canned" %}

    {% do task_dict.update({
        "app_name": "canned_test",
        "kgo_checks": [],
    }) %}

{% elif task.startswith("build") %}

    {% do task_dict.update({
        "placeholder": true,
    }) %}

{% endif %}

{% if "production" in task_ns.extras %}

    {# We turn off kgo checking for production tasks as the kgo is too variable #}

    {% do task_dict.update({
        "kgo_checks": [],
    }) %}

{% endif %}

{# Set default values for lfric_atm tasks #}
{% if task_dict %}
    {% do task_dict.update({"application_dir": "lfric_apps/applications/lfric_atm"}) %}
    {% if "app_name" not in task_dict %}
        {% do task_dict.update({"app_name": "lfric_atm"}) %}
    {% endif %}
{% endif %}

{# Extensions to the Shared Global Configurations - Performance setups#}
{% if task_ns.conf_name.startswith("nwp_gal9-C896_MG_720t") %}

    {% do task_dict.update({
        "opt_confs": ["um_dump"],
        "tsteps": 720,
        "wallclock": 60,
        "plot_str": "",
        "restart_write": false,
    }) %}
{% endif %}

{% if task_ns.conf_name.startswith("nwp_gal9-C896_MG_720t_opDiag") %}

    {% do task_dict.update({
        "opt_confs": ["um_dump","oper_diags_hres"],
    }) %}

{% endif %}


{% do LOG.debug("Finished in site/common/lfric_atm/tasks_lfric_atm.cylc") %}
